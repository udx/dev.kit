#compdef dev.kit

_dev_kit() {
  local -a commands
  commands=(
    'help:Show help'
    'version:Print version'
    'paths:Show key paths'
    'codex:Codex helpers'
    'install:Install dev.kit'
    'update:Update dev.kit'
    'uninstall:Uninstall dev.kit'
    'enable:Enable shell integration'
    'init:Session bootstrap'
    'test:Run module tests'
    'session:Session helpers'
    'doctor:Health checks'
    'clock:Wall-clock helper'
    'capture:Capture logs'
    'config:Config helpers'
  )

  if (( CURRENT == 2 )); then
    _describe 'command' commands
    return
  fi

  case "$words[2]" in
    codex)
      _arguments '1:subcommand:(config rules skills clock)' '--get-rules' '--plan-rules' '--apply-rules' '--show' '--plan' '--apply'
      ;;
    install)
      _arguments
      ;;
    uninstall)
      _arguments '--purge'
      ;;
    enable)
      _arguments '--shell=bash' '--shell=zsh' '--file=' '--force'
      ;;
    test)
      _arguments '--module' '--module=' '--suite' '--suite=' '--all' '--mock' '--run' '--list' '--force'
      ;;
    clock)
      _arguments '1:subcommand:(start status reset)' '--scope' '--scope=' '--root' '--root=' '--global'
      ;;
    session)
      _arguments '1:subcommand:(start status summary save)' '--force'
      ;;
    capture)
      _arguments '1:subcommand:(start stop status show shell clear auto-clean)' \
        '--input' '--no-shell' '--force' '2:toggle:(on off)'
      ;;
    config)
      _arguments '1:subcommand:(show reset set global repo)' '--force' \
        '2:key:(quiet codex_suggest capture.enabled capture.full capture.auto_clean capture.auto_clean_iteration capture.ttl_days_global capture.ttl_days_repo)'
      ;;
  esac
}

_dev_kit "$@"

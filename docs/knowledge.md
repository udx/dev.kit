# Knowledgebase: Patterns and Templates

Purpose: capture reusable documentation and scripting patterns derived from
past work. These are optional references, not execution contracts.

## Documentation Patterns

- Keep scope explicit (client project vs cluster project, etc.).
- Required inputs are positional; defaults only when stable.
- Provide both manual steps and a script path when possible.
- Include a minimal verification section with read-only commands.
- Keep examples short and runnable.

## Script Patterns

- Bash only; use `set -euo pipefail`.
- Required inputs as positional args.
- Optional inputs as env overrides.
- Validate dependencies early (e.g., `gcloud`, `yq`).
- Deterministic output; minimal side effects.

## Report Patterns

- Read from a single source of truth.
- Include generated timestamp and source path.
- Prefer Markdown tables for scanability.

## Templates

Doc template:

```md
# <topic>

One-line summary.

> Scope: <client project | cluster project | both>.

## Required inputs
- <input 1>
- <input 2>

## Scripted setup

```bash
bin/scripts/<script-name>.sh <args>
```

## Manual setup (gcloud)

```bash
# commands
```

## Verification (read-only)

```bash
# commands
```

## Notes
- <assumption>
```

Script template:

```bash
#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'USAGE'
Usage: bin/scripts/<script-name>.sh <REQUIRED_1> <REQUIRED_2>

Optional environment overrides:
  OPTIONAL_1  Default: <value>
USAGE
}

if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  usage
  exit 0
fi

if [[ $# -ne 2 ]]; then
  usage
  exit 1
fi

REQUIRED_1="$1"
REQUIRED_2="$2"
OPTIONAL_1="${OPTIONAL_1:-<value>}"

if ! command -v gcloud >/dev/null 2>&1; then
  echo "gcloud not found." >&2
  exit 1
fi

# Do work
```

Report template:

```md
# <report name>

Generated by `bin/scripts/<report-script>.sh`.

Run:

```bash
bin/scripts/<report-script>.sh
```
```

PR description template:

```
Related Github issue: <link>

## Changes

- <summary>
- <summary>
- <summary>
```

## Diagram Notes

- Keep Mermaid markup aligned with repo style (`flowchart TD`, short labels).
- Use `<br/>` for line breaks.
- Store Mermaid sources alongside articles and reference SVGs in the article.

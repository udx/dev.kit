# ~/.codex/rules/default.rules
# Execpolicy rules for Codex CLI (Starlark).
# Docs: https://developers.openai.com/codex/rules

# -------------------------------------------------------------------
# Prevent dev.kit pipeline loops / self-triggering automation
# -------------------------------------------------------------------
prefix_rule(
    pattern = ["dev.kit", "-p"],
    decision = "forbidden",
    justification = "Avoid dev.kit pipeline loops. Run dev.kit without -p and review output first.",
    match = [
        "dev.kit -p",
        "dev.kit -p build",
        "dev.kit -p deploy --env prod",
    ],
    not_match = [
        "dev.kit",
        "dev.kit capture show",
        "dev.kit help",
    ],
)

# If you also use the long flag, keep this (remove if not applicable).
prefix_rule(
    pattern = ["dev.kit", "--pipeline"],
    decision = "forbidden",
    justification = "Avoid dev.kit pipeline loops. Run dev.kit without --pipeline and review output first.",
    match = [
        "dev.kit --pipeline build",
    ],
)
